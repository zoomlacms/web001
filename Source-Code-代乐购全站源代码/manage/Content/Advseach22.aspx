<%@ page language="C#" autoeventwireup="true" inherits="ZoomLa.WebSite.Manage.Content.Advseach22, App_Web_eslo4wtw" enableEventValidation="false" viewStateEncryptionMode="Never" %>
<!DOCTYPE HTML>
<html>
<head runat="server">
<title>信息高级查询</title>
<link href="../../App_Themes/AdminDefaultTheme/Guide.css" type="text/css" rel="stylesheet" />
<link href="../../App_Themes/AdminDefaultTheme/index.css" type="text/css" rel="stylesheet" />
<link href="../../App_Themes/AdminDefaultTheme/main.css" type="text/css" rel="stylesheet" />
<script src="/JS/Common.js" type="text/javascript"></script>
<script src="/JS/calendar.js" type="text/javascript"></script>
</head>
<body id="MasterPagebody">
<script type="text/javascript" src="/JS/CommonCode.js"></script>

<form name="aspnetForm" method="post" action="manage_Content_Advseach22" onsubmit="javascript:return WebForm_OnSubmit();" id="aspnetForm">
<div>
<input type="hidden" name="__EVENTTARGET" id="__EVENTTARGET" value="" />
<input type="hidden" name="__EVENTARGUMENT" id="__EVENTARGUMENT" value="" />
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUKLTQ1MzM4OTU3MA9kFgJmD2QWAgIBD2QWAgIDD2QWBAIBDxAPFgYeDURhdGFUZXh0RmllbGQFCE5vZGVOYW1lHg5EYXRhVmFsdWVGaWVsZAUGTm9kZUlkHgtfIURhdGFCb3VuZGdkEBUUDOWKqOaYk+WVhuWfjg/CoMKg4pScwqDkuabnsY0PwqDCoOKUnMKg5pyN6KOFEsKgwqDilJzCoOWMluWmhuWTgQ/CoMKg4pScwqDmiYvmnLoPwqDCoOKUnMKg54K55Y2hD8KgwqDilJzCoOeUteiEkRjCoMKg4pScwqDnrJTorrDmnKznlLXohJEVwqDCoOKUnMKg5pWw56CB55u45py6FcKgwqDilJTCoOmfs+WDj+WItuWTgQzotYTorq/kuK3lv4MVwqDCoOKUnMKg6LSt5Lmw5oyH5Y2XFcKgwqDilJzCoOihjOaDheaSreaKpRXCoMKg4pScwqDmtYvor4TmiqXlkYoVwqDCoOKUnMKg57u85ZCI6LWE6K6vDOWxleekuuS4reW/gwzkuIvovb3kuK3lv4MG5YWs5ZGKDOWPi+aDhemTvuaOpQzlrqLmiLfnlZnoqIAVFAE0ATkCMTACMTECMTICMTMCMTQCMTUCMTYCMTcBMQIxOAIxOQIyMAIyMQEyATMBNQE2ATcUKwMUZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dkZAIDDxAPFgYfAAUJTW9kZWxOYW1lHwEFB01vZGVsSWQfAmcWAh4Ib25jaGFuZ2UFO0dldFNlcnZpY2VzKHRoaXMub3B0aW9uc1t0aGlzLm9wdGlvbnMuc2VsZWN0ZWRJbmRleF0udmFsdWUpDxYHAgECAgIDAgQCBQIGAgcWBxAFDOaWh+eroOaooeWeiwUBMWcQBQzlm77niYfmqKHlnosFATJnEAUM6L2v5Lu25qih5Z6LBQEzZxAFDOWFrOWRiuaooeWeiwUBNGcQBRLlj4vmg4Xpk77mjqXmqKHlnosFAjExZxAFDOeVmeiogOaooeWeiwUCMjFnEAUS6L2s5ZCR6ZO+5o6l5qih5Z6LBQIyMmdkZBgBBR5fX0NvbnRyb2xzUmVxdWlyZVBvc3RCYWNrS2V5X18WAgUZY3RsMDAkQ3BoQ29udGVudCRMaXN0Tm9kZQUfY3RsMDAkQ3BoQ29udGVudCRMaXN0TW9kZWxGaWVsZLJYYIxAjYCb1j3RA1gLlFqzxyci" />
</div>
 
<script type="text/javascript"> 
<!--
var theForm = document.forms['aspnetForm'];
if (!theForm) {
    theForm = document.aspnetForm;
}
function __doPostBack(eventTarget, eventArgument) {
    if (!theForm.onsubmit || (theForm.onsubmit() != false)) {
        theForm.__EVENTTARGET.value = eventTarget;
        theForm.__EVENTARGUMENT.value = eventArgument;
        theForm.submit();
    }
}
// -->
</script>
 <script src="/WebResource.axd?d=9LsAG1itwS8QCy15euq-Tw2&amp;t=633793083772812500" type="text/javascript"></script>
 <script src="/WebResource.axd?d=8Zl6Ln3GyLjg5TKAyY0FzX9eM_x8iTuUZKIy52fkfss1&amp;t=633793083772812500" type="text/javascript"></script>
<script src="/ScriptResource.axd?d=47I3-7ZcjvOFvGAvCJwFti4PbCVe5NL_ouqZGrFNuw2LGb7UOKyz85dD0F4LDzsh0&amp;t=633789518111718750" type="text/javascript"></script>
<script src="/ScriptResource.axd?d=47I3-7ZcjvOFvGAvCJwFti4PbCVe5NL_ouqZGrFNuw304QLdRPWUrsj1bc9EBy9CVRSpTIXf7kmq49DvPIK_kQ2&amp;t=633789518111718750" type="text/javascript"></script>
<script src="manage_Content_Advseach22" type="text/javascript"></script>
<script type="text/javascript"> 
<!--
function WebForm_OnSubmit() {
if (typeof(ValidatorOnSubmit) == "function" && ValidatorOnSubmit() == false) return false;
return true;
}
// -->
</script>
 
	<div>
    <span id="ctl00_CphNavigation_SmpNavigator" style="display:inline-block;height:20px;"><span>
        <img src="../../App_Themes/AdminDefaultTheme/Images/localGIF.gif" align="absmiddle" style="border-width:0px;" />后台管理
    </span><span> &gt;&gt; </span><span><a title="内容管理">内容管理</a></span><span> &gt;&gt; </span><span><a title="栏目信息管理" href="/admin/Contents/ContentManage.aspx?t=159">栏目信息管理</a></span><span> &gt;&gt; </span><span><a>信息高级查询</a></span></span>
    <script type="text/javascript"> 
//<![CDATA[
Sys.WebForms.PageRequestManager._initialize('ctl00$CphContent$ScriptManageContent', document.getElementById('aspnetForm'));
Sys.WebForms.PageRequestManager.getInstance()._updateControls([], [], [], 90);
//]]>
</script>
 
    <div>
    <table style="width: 100%; margin: 0 auto;" cellpadding="2" cellspacing="1" class="border">
        <tr align="center">
            <td colspan="3" class="spacingtitle">内容高级查询</td>
        </tr>
        <tr valign="top" class="tdbg">
            <td style="width: 208px;">
                <strong>选择节点：</strong>
                <br />
                <select size="4" name="ctl00$CphContent$ListNode" multiple="multiple" id="ctl00_CphContent_ListNode" style="height:230px;width:200px;">
	<option value="4">动易商城</option>
	<option value="9">&#160;&#160;├&#160;书籍</option>
	<option value="10">&#160;&#160;├&#160;服装</option>
	<option value="11">&#160;&#160;├&#160;化妆品</option>
	<option value="12">&#160;&#160;├&#160;手机</option>
	<option value="13">&#160;&#160;├&#160;点卡</option>
	<option value="14">&#160;&#160;├&#160;电脑</option>
	<option value="15">&#160;&#160;├&#160;笔记本电脑</option>
	<option value="16">&#160;&#160;├&#160;数码相机</option>
	<option value="17">&#160;&#160;└&#160;音像制品</option>
	<option value="1">资讯中心</option>
	<option value="18">&#160;&#160;├&#160;购买指南</option>
	<option value="19">&#160;&#160;├&#160;行情播报</option>
	<option value="20">&#160;&#160;├&#160;测评报告</option>
	<option value="21">&#160;&#160;├&#160;综合资讯</option>
	<option value="2">展示中心</option>
	<option value="3">下载中心</option>
	<option value="5">公告</option>
	<option value="6">友情链接</option>
	<option value="7">客户留言</option>
 
</select>
                <span style="color:Red;">* </span><span id="ctl00_CphContent_ValrNodeName" style="color:Red;display:none;">栏目名称不能为空！</span>
            </td>
            <td style="width: 208px;">
                <strong>选择模型：</strong><br />
                <select name="ctl00$CphContent$DropModel" id="ctl00_CphContent_DropModel" onchange="GetServices(this.options[this.options.selectedIndex].value)" style="width:200px;">
	<option selected="selected" value="-1">请选择模型</option>
	<option value="1">文章模型</option>
	<option value="2">图片模型</option>
	<option value="3">软件模型</option>
	<option value="4">公告模型</option>
	<option value="11">友情链接模型</option>
	<option value="21">留言模型</option>
	<option value="22">转向链接模型</option>
 
</select>
                <br />
                <strong>选择查询字段：</strong><br />
                <select size="2" name="ctl00$CphContent$ListModelField" multiple="multiple" id="ctl00_CphContent_ListModelField" style="height:188px;width:200px;">
 
</select>
                <br /><br />
               <span style="float:right"><input value ="增加查询字段 ==〉" type ="button" class="C_input"   onclick="AddSearchField(aspnetForm.ctl00_CphContent_ListModelField)" /></span> 
            </td>
            <td id ="searchValueList">
            </td>
        </tr>
        <tr class="tdbg">
            <td colspan="3" align="center" >
                <input type="hidden" name="ctl00$CphContent$HdnSearchValue" id="ctl00_CphContent_HdnSearchValue" />
                <input type="submit" name="ctl00$CphContent$BtnAdvancedSearch" class="C_input"   value="开始查询" onclick="return BtnAdvancedSearch();WebForm_DoPostBackWithOptions(new WebForm_PostBackOptions(&quot;ctl00$CphContent$BtnAdvancedSearch&quot;, &quot;&quot;, true, &quot;&quot;, &quot;&quot;, false, false))" id="ctl00_CphContent_BtnAdvancedSearch" class="inputbutton" onmouseover="this.className='inputbutton_hover'" onmouseout="this.className='inputbutton'" />
            </td>
        </tr>
    </table>
    </div>
 
    <script language="javascript" type="text/javascript">
        var loadModel = false;
        
        function GetServices(value)
        {
            PowerEasy.SiteFactory.WebSite.Admin.Contents.CategoryService.GetFieldList(value,getFieldList);  //这里 WebServices 在加载下拉框时间不固定，在火狐浏览器下难以获取 火狐浏览器在WebServices 延迟函数很多失效 不得不采用全局变量解决此问题。
            $get("ctl00_CphContent_HdnSearchValue").value= "";
            loadModel = false;
        }
        function getFieldList(value)
        {
           var fieldList=$get("ctl00_CphContent_ListModelField");
           fieldList.innerHTML="";
            for(var i=0;i<value.length;i++)
            {
                if(value[i].FieldName!=null&&value[i].FieldAlias!=null)
                {                
                    fieldList.options[fieldList.options.length] = new Option(value[i].FieldAlias, value[i].FieldName, 0, 0);
                }
            }
        }
 
        function createField(ItemList)
        {
            var searchValue = "";
            var searchName = "";
                
            for(var x=0;x < ItemList.length;x++)
            {
                var opt = ItemList.options[x];
                if (searchValue == ""){
                    searchValue = opt.value;
                    searchName = opt.text;
                }
                else
                {
                    searchValue += "," + opt.value;
                    searchName += "," + opt.text;
                }
            }
 
            if (searchValue == ""){
                return;
            }
            var searchinnetHtml = " <table style=\"width: 100%;\" cellpadding=\"2\" cellspacing=\"1\" class=\"border\">";
 
            if (searchValue.indexOf(',') > 0){
                var arrSearchValue =  searchValue.split(',');
                var arrSearchName =  searchName.split(',');
                for (var i=0;i < arrSearchValue.length;i++){
                    searchinnetHtml += "<tr class ='tdbg' id = 'h_" + arrSearchValue[i] + "' style='display:none;'><td class='tdbgleft' width='25%'>" + arrSearchName[i] + " 查询值： </td><td class='tdbg' ><input size='30' maxlength='30' type='text' name= '" + arrSearchValue[i] + "'/> <span style='cursor: pointer;' onclick=\"delItem('h_" + arrSearchValue[i] + "','" + arrSearchName[i] + "')\"><img src=\"/admin/Images/Del.gif\"  BORDER='0'   ALT='删除" + arrSearchName[i] + "' /></span></td></tr>";
                }
            }
            else 
            {
                searchinnetHtml += "<tr class ='tdbg' id = 'h_" + searchValue + "' style='display:none;'><td class='tdbgleft' width='25%'>" + searchName + " 查询值： </td><td class='tdbg'><input size='30' maxlength='30' type='text' name= '" + searchValue + "'/> <span style='cursor: pointer;' onclick=\"delItem('h_" + searchValue + "','" + searchName + "')\"><img src=\"/admin/Images/Del.gif\"  BORDER='0'   ALT='删除" + searchName + "' /></span></td></tr>";
            }
 
            searchinnetHtml += "</table>";
            $get("searchValueList").innerHTML= searchinnetHtml;      
        }
        
        function AddSearchField(ItemList){            
            if (!loadModel) {
                createField($get("ctl00_CphContent_ListModelField"));
                loadModel = true;
            }
            
            var hdnSearchValue =  $get("ctl00_CphContent_HdnSearchValue").value;
            for(var x=ItemList.length-1;x>=0;x--)
            {
                var opt = ItemList.options[x];
                if (opt.selected)
                {
                    $get("h_" + opt.value).style.display="";
                    if (hdnSearchValue != ""){
                        hdnSearchValue += "," + opt.value;
                    }else{
                        hdnSearchValue = opt.value;
                    }
                    ItemList.options[x] = null;
                }
            }
            
            $get("ctl00_CphContent_HdnSearchValue").value= hdnSearchValue;
        }
        
        function delItem(value,name){
            var searchValue = "";
            var iSearchValue = value.replace('h_','');
            var hSearchValue = $get("ctl00_CphContent_HdnSearchValue").value;
            
            if (hSearchValue == ""){
                return;
            } 
            
            if (hSearchValue.indexOf(',') > 0){
                arrSearchValue = hSearchValue.split(',');
                for (var i= 0;i < arrSearchValue.length; i++) {
                    if ( iSearchValue != arrSearchValue[i]){
                        if (searchValue == "") {
                            searchValue = arrSearchValue[i];
                        }
                        else{
                            searchValue += "," + arrSearchValue[i];
                        }
                    }
                }
            }
            else
            {
                if (iSearchValue != hSearchValue){
                    searchValue = hSearchValue;
                }
            }
            
            var fieldList=$get("ctl00_CphContent_ListModelField");
            fieldList.options[fieldList.options.length] = new Option(name, iSearchValue, 0, 0);
            $get(value).style.display="none";
            $get("ctl00_CphContent_HdnSearchValue").value = searchValue; 
        }
 
        function BtnAdvancedSearch(){
            var isSelectedNodeId = "";
            var nodeList=$get("ctl00_CphContent_ListNode");
            
            for(var x=nodeList.length-1;x>=0;x--)
            {
	            var opt = nodeList.options[x];
	            if (opt.selected)
	            {
	               isSelectedNodeId= "true";
	               break;
	            }
            }
            
            if (isSelectedNodeId == ""){
	            alert("没有选择要查询的节点！");
	            return false ;
            }      
            
            var searchValue = $get("ctl00_CphContent_HdnSearchValue").value;
            if (searchValue == ""){
	            alert("没有选择要查询的字段！");
	            return false ;
            }
            if (searchValue.indexOf(",") > 0 ) {
                var arrSearchValue = searchValue.split(',');
                for (var i = 0; i < arrSearchValue.length; i++){
                    if ($get(arrSearchValue[i]).value == ""){
                        alert(arrSearchValue[i] + " 字段查询值不能为空！");
                        return false ;
                    }
                }
            }
            else
            {
                if (searchValue == ""){
                    alert(searchValue + " 字段查询值不能为空！");
                    return false ;
                }
            }
        }
    </script>
        </div>
        <br />
    
<script type="text/javascript"> 
<!--
var Page_Validators =  new Array(document.getElementById("ctl00_CphContent_ValrNodeName"));
// -->
</script>
 
<script type="text/javascript"> 
<!--
var ctl00_CphContent_ValrNodeName = document.all ? document.all["ctl00_CphContent_ValrNodeName"] : document.getElementById("ctl00_CphContent_ValrNodeName");
ctl00_CphContent_ValrNodeName.controltovalidate = "ctl00_CphContent_ListModelField";
ctl00_CphContent_ValrNodeName.focusOnError = "t";
ctl00_CphContent_ValrNodeName.errormessage = "栏目名称不能为空！";
ctl00_CphContent_ValrNodeName.display = "Dynamic";
ctl00_CphContent_ValrNodeName.evaluationfunction = "RequiredFieldValidatorEvaluateIsValid";
ctl00_CphContent_ValrNodeName.initialvalue = "";
// -->
</script> 
 
<script type="text/javascript"> 
<!--
var Page_ValidationActive = false;
if (typeof(ValidatorOnLoad) == "function") {
    ValidatorOnLoad();
}
 
function ValidatorOnSubmit() {
    if (Page_ValidationActive) {
        return ValidatorCommonOnSubmit();
    }
    else {
        return true;
    }
}
// -->
</script>
        
<script type="text/javascript"> 
<!--
Sys.Application.initialize();
// -->
</script>
</form>
</body>
</html>